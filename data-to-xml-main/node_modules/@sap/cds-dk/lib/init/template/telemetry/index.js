const cds = require('../../../cds')
const { readProject } = require('../../projectReader')

module.exports = class extends require('../../plugin') {

  static hasInProduction(env) {
    return !!env.requires?.telemetry || cds.cli.argv?.includes('telemetry') || !!cds.cli.options?.add?.telemetry
  }

  async canRun() {
    const { hasMta, hasHelm, hasHelmUnifiedRuntime } = readProject()
    if ((hasHelmUnifiedRuntime || hasHelm) && !hasMta) throw `'cds add telemetry' is not available for Kyma yet`
    return true
  }

  requires() {
    return ['cloud-logging']
  }
}
