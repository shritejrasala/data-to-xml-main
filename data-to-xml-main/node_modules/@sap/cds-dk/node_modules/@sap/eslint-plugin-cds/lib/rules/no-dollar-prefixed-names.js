'use strict'

module.exports = {
  meta: {
    schema: [{/* to avoid deprecation warning for ESLint 9 */}],
    docs: {
      description: 'Names must not start with $ to avoid possible shadowing of reserved variables.',
      recommended: true,
      url: 'https://cap.cloud.sap/docs/tools/cds-lint/meta/no-dollar-prefixed-names',
    },
    messages: {
      dollarPrefix: `'{{name}}' is prefixed with a dollar sign ($)`,
    },
    type: 'problem'
  },
  create (context) {
    return { element: _check }

    function _check (d) {
      const srv = d._service || (d.parent && d.parent._service)
      if (srv && srv['@cds.external']) return
      if (d.name.startsWith('$')) {
        context.report({
          messageId: 'dollarPrefix',
          data: { name: d.name },
          node: context.getNode(d)
        })
      }
    }
  }
}
